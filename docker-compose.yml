version: '3.8'

services:
  rainyun-qiandao:
    build: .
    container_name: rainyun-qiandao
    env_file:
      - .env
    environment:
      - RAINYUN_USER=${RAINYUN_USER}        # 雨云用户名
      - RAINYUN_PWD=${RAINYUN_PWD}          # 雨云密码
      - TIMEOUT=${TIMEOUT:-15}              # 连接超时等待(秒)
      - MAX_DELAY=${MAX_DELAY:-90}          # 最大随机等待延时(分钟)
      - DEBUG=${DEBUG:-false}               # 调试模式
      # 服务器管理功能 (可选)
      - RAINYUN_API_KEY=${RAINYUN_API_KEY:-}           # API密钥
      - AUTO_RENEW=${AUTO_RENEW:-true}                 # 自动续费开关
      - RENEW_THRESHOLD_DAYS=${RENEW_THRESHOLD_DAYS:-7}  # 续费触发阈值
      - RENEW_PRODUCT_IDS=${RENEW_PRODUCT_IDS:-}         # 续费白名单
      # 推送服务 (示例)
      - PUSH_KEY=${PUSH_KEY:-}                           # Server酱推送密钥
    volumes:
      - ./temp:/app/temp                    # 临时文件目录
      - ./cookies.json:/app/cookies.json    # 持久化 cookies
      - ./rainyun.py:/app/rainyun.py
    shm_size: '2gb'                         # Chrome 需要足够的共享内存
    restart: "no"
